<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="google" content="notranslate">
    <title>Classificador de E-mails com IA</title> 
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container py-5">
        <h1 class="text-center mb-4">
            <i class="fa-solid fa-envelope-open-text text-primary"></i>
            Classificador de E-mails com IA
        </h1>

        <div class="row justify-content-center">
            <div class="col-md-8">
                <div class="card shadow-sm mb-4">
                    <div class="card-body">
                        <form method="POST" action="/processar" enctype="multipart/form-data" id="form-email">
                            <div class="mb-3">
                                <label for="texto_email" class="form-label">Cole o conteÃºdo do e-mail:</label>
                                <textarea class="form-control" id="texto_email" name="texto_email" rows="6" placeholder="Digite ou cole aqui...">{{ texto_email or "" }}</textarea>
                            </div>

                            <div class="mb-3">
                                <label for="arquivo_email" class="form-label">Ou envie um arquivo (.txt ou .pdf):</label>
                                <input type="file" class="form-control" id="arquivo_email" name="arquivo_email" accept=".txt,.pdf">
                            </div>

                            <div class="d-flex gap-2">
                                <button type="submit" class="btn btn-primary btn-lg">
                                    <i class="fa-solid fa-paper-plane"></i> Enviar para IA
                                </button>
                                <button type="button" class="btn btn-outline-secondary btn-lg" id="btn-limpar">
                                    <i class="fa-solid fa-eraser"></i> Limpar
                                </button>
                            </div>
                        </form>
                        <!-- Dica ou informaÃ§Ã£o extra -->
                        <div class="text-warning small mt-2">
                            <i class="fa-solid fa-circle-info text-warning"></i> VocÃª pode colar o e-mail ou enviar um arquivo PDF/TXT.
                        </div>
                    </div>
                </div>
                {% if categoria or resposta %}
                <div class="card shadow-sm mb-4">
                    <div class="card-body">
                        {% if categoria %}
                            <div class="mt-4">
                                <h4>Categoria detectada:</h4>
                                <span class="badge {% if categoria == 'Produtivo' %}bg-success{% else %}bg-secondary{% endif %} fs-4 py-2 px-4">
                                    <i class="fa-solid fa-tag"></i> {{ categoria }}
                                </span>
                            </div>
                        {% endif %}

                        {% if resposta %}
                            <div class="mt-4">
                                <h4><i class="fa-solid fa-robot text-info"></i> Resposta sugerida:</h4>
                                <div class="alert alert-info fs-5">
                                    {{ resposta }}
                                </div>
                            </div>
                        {% endif %}
                    </div>
                </div>
                {% endif %}
                {% if historico and historico|length > 1 %}
                <div class="card shadow-sm mb-4 bg-light">
                    <div class="card-body">
                        <h5 class="mb-3"><i class="fa-solid fa-clock-rotate-left text-secondary"></i> HistÃ³rico recente</h5>
                        <ul class="list-group list-group-flush">
                            {% for item in historico[1:] %}
                            <li class="list-group-item">
                                <div class="fw-bold small mb-1">Categoria: <span class="badge {% if item.categoria == 'Produtivo' %}bg-success{% else %}bg-secondary{% endif %}">{{ item.categoria }}</span></div>
                                <div class="mb-1"><span class="text-muted small">Trecho:</span> {{ item.texto[:80] }}{% if item.texto|length > 80 %}...{% endif %}</div>
                                <div class="text-muted small">Resposta: {{ item.resposta }}</div>
                            </li>
                            {% endfor %}
                        </ul>
                    </div>
                </div>
                {% endif %}
            </div>
        </div>

        <footer class="text-center mt-5 text-white small">
            Desenvolvido por Manoela | IA + Flask ðŸ¤–ðŸ’Œ
        </footer>
    </div>

    <!-- Bootstrap Bundle JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<!-- Spinner de carregamento da IA -->
<script>
  const form = document.querySelector("#form-email");
  const spinnerContainer = document.createElement("div");
  spinnerContainer.className = "text-center my-4";
  spinnerContainer.innerHTML = `
    <div class="spinner-border text-info" role="status">
      <span class="visually-hidden">IA processando...</span>
    </div>
    <p class="mt-2" style="color: #ecca2f;">IA estÃ¡ analisando seu e-mail...</p>
  `;

  form.addEventListener("submit", () => {
    const existente = document.querySelector(".spinner-border");
    if (!existente) {
      form.insertAdjacentElement("afterend", spinnerContainer);
    }
  });

  // BotÃ£o de limpar formulÃ¡rio e resultados
  document.getElementById("btn-limpar").addEventListener("click", function() {
    document.getElementById("texto_email").value = "";
    document.getElementById("arquivo_email").value = "";
    window.location.href = "/";
  });
</script>
</body>
</html>

